<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>CLI Test</title>
</head>
<body>
    <h1>è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...</h1>
    <pre id="output"></pre>
    
    <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web@1.17.1/dist/ort.min.js"></script>
    <script src="onnx-runtime-wrapper.js"></script>
    
    <script>
        const output = document.getElementById('output');
        
        function log(msg) {
            output.textContent += msg + '\n';
            console.log(msg);
        }
        
        async function runAutomatedTest() {
            log('========================================');
            log('ONNX Runtime WebGL è‡ªå‹•ãƒ†ã‚¹ãƒˆ');
            log('========================================\n');
            
            try {
                // 1. åˆæœŸåŒ–
                log('[1] ONNX RuntimeåˆæœŸåŒ–ä¸­...');
                const initResult = await window.UnityONNX.initialize(
                    'ja_JP-test-medium.onnx',
                    'ja_JP-test-medium.onnx.json'
                );
                
                if (!initResult.success) {
                    throw new Error('åˆæœŸåŒ–å¤±æ•—: ' + initResult.error);
                }
                log('âœ“ åˆæœŸåŒ–æˆåŠŸ\n');
                
                // 2. æœ€å°ãƒ†ã‚¹ãƒˆ
                log('[2] æœ€å°ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®Ÿè¡Œä¸­...');
                const testResult = await window.UnityONNX.runMinimalTest();
                
                if (testResult.success) {
                    log(`âœ“ å˜ä¸€éŸ³ç´  "ã‚": ${testResult.minimal} samples`);
                    log(`âœ“ "ã“ã‚“ã«ã¡ã¯": ${testResult.konnichiwa} samples`);
                    
                    const ratio = testResult.konnichiwa / 18000;
                    if (ratio > 3) {
                        log(`\nâš ï¸ è­¦å‘Š: éŸ³å£°ãŒ${ratio.toFixed(1)}å€é•·ã„ï¼`);
                        log('ã“ã‚ŒãŒUnity WebGLã®å•é¡Œã§ã™ã€‚');
                    } else if (ratio > 1.5) {
                        log(`\nâš ï¸ éŸ³å£°ãŒã‚„ã‚„é•·ã„: ${ratio.toFixed(1)}å€`);
                    } else {
                        log('\nâœ“ éŸ³å£°é•·ã¯æ­£å¸¸ç¯„å›²å†…');
                    }
                } else {
                    throw new Error('ãƒ†ã‚¹ãƒˆå¤±æ•—: ' + testResult.error);
                }
                
                // 3. è©³ç´°ãƒ†ã‚¹ãƒˆ
                log('\n[3] è©³ç´°ãªéŸ³ç´ ãƒ†ã‚¹ãƒˆ...');
                const testPatterns = [
                    { name: 'çŸ­ã„: "ã‚"', ids: [1, 7, 2], expected: 3000 },
                    { name: 'ä¸­: "ã‚ã‚ŠãŒã¨ã†"', ids: [1, 7, 54, 8, 28, 7, 31, 11, 9, 2], expected: 15000 },
                    { name: 'é•·ã„: "ã“ã‚“ã«ã¡ã¯"', ids: [1, 25, 11, 22, 50, 8, 39, 8, 56, 7, 2], expected: 18000 }
                ];
                
                for (const pattern of testPatterns) {
                    const result = await window.UnityONNX.synthesize(pattern.ids);
                    if (result.success) {
                        const samples = result.data.length;
                        const ratio = samples / pattern.expected;
                        const status = ratio > 3 ? 'âŒ' : ratio > 1.5 ? 'âš ï¸' : 'âœ“';
                        log(`${status} ${pattern.name}: ${samples} samples (${ratio.toFixed(1)}x expected)`);
                    }
                }
                
                log('\n========================================');
                log('ãƒ†ã‚¹ãƒˆå®Œäº†');
                log('========================================');
                
                // 4. çµè«–
                log('\nðŸ“Š è¨ºæ–­çµæžœ:');
                if (testResult.konnichiwa / 18000 > 3) {
                    log('å•é¡Œ: éŸ³å£°ãƒ‡ãƒ¼ã‚¿ãŒ5-8å€ã«ä¼¸é•·ã•ã‚Œã¦ã„ã¾ã™');
                    log('åŽŸå› : Unity WebGLã¨ONNX Runtime Webã®çµ±åˆå•é¡Œã®å¯èƒ½æ€§');
                    log('æŽ¨å¥¨: ã‚·ãƒ³ãƒ—ãƒ«å‡¦ç†ï¼ˆpiper-plusã‚¹ã‚¿ã‚¤ãƒ«ï¼‰ã‚’ä½¿ç”¨');
                } else {
                    log('âœ“ éŸ³å£°ç”Ÿæˆã¯æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™');
                }
                
            } catch (error) {
                log('\nâŒ ã‚¨ãƒ©ãƒ¼: ' + error.message);
                console.error(error);
            }
        }
        
        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰å¾Œã«è‡ªå‹•å®Ÿè¡Œ
        window.addEventListener('load', () => {
            setTimeout(runAutomatedTest, 1000);
        });
    </script>
</body>
</html>