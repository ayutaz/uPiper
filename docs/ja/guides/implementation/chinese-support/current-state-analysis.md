# 中国語サポート実装 - 現状分析レポート

## 概要

uPiperの中国語サポートは現在プロトタイプ段階で、基本的なフレームワークは存在するものの、実用的な音素化機能は未実装です。

## 現在の実装状況

### ✅ 実装済み機能

1. **基本フレームワーク**
   - `ChinesePhonemizer`クラスの基本構造
   - 複数の中国語バリアント対応（zh, zh-CN, zh-TW, zh-HK, zh-SG）
   - スレッドセーフな辞書アクセス
   - MultilingualPhonemizerServiceへの統合

2. **最小限のピンイン辞書**
   - **サイズ**: ハードコードされた10文字のみ
   - **カバレッジ**: 你、好、中、国、人、我、是、的、一、不
   - **サンプル辞書**: `pinyin_dict_sample.txt`に422文字（実際は421文字+ヘッダー）

3. **中国語文字判定**
   - CJK統合漢字（0x4E00-0x9FFF）
   - CJK拡張A（0x3400-0x4DBF）
   - CJK互換漢字（0xF900-0xFAFF）

### ❌ 未実装・不完全な機能

#### 1. ピンイン辞書の制限
- **現在のサイズ**: 約422文字 vs **必要**: 基本的な使用で20,000文字以上
- **本番環境要件**: pypinyin-dict（42,000文字以上）またはCC-CEDICT（120,000エントリ以上）
- **多音字対応**: サンプル辞書には複数読みがあるが、実装は最初の読みのみ使用
- **辞書読み込み**: 外部辞書ファイルの読み込み機能なし

#### 2. テキスト分割 - 致命的な制限
```csharp
// 現在の実装 - 1文字ずつ分割のみ
private List<string> SegmentText(string text)
{
    var segments = new List<string>();
    foreach (var ch in text)
    {
        segments.Add(ch.ToString()); // 単語境界なし！
    }
    return segments;
}
```

**問題点**:
- 単語分割なし（中国語処理に必須）
- 複合語の処理なし
- 文脈を考慮した読み選択なし

#### 3. ピンインからIPAへの変換 - 機能せず
```csharp
private string[] PinyinToIPA(string pinyin)
{
    // 現在の実装はスタブ
    var tone = pinyin[^1];           // 声調番号を抽出
    var syllable = pinyin[..^1];     // 音節を抽出
    return new[] { syllable };       // 元の音節を返す、IPAではない！
}
```

**重大な問題**:
- **IPA変換なし** - 元のピンイン音節を返すだけ
- **声調マーク変換なし**（例：`ma1` → `ma˥`、`ma2` → `ma˧˥`）
- **音素分解なし**（例：`zhong` → `ʈ͡ʂoŋ`）
- **声母・韻母のIPAマッピングなし**

#### 4. 声調処理 - 未実装
ドキュメントによると以下をサポートすべき：
- `ma1` → `ma˥`（第一声：高平調）
- `ma2` → `ma˧˥`（第二声：上昇調）
- `ma3` → `ma˨˩˦`（第三声：低降昇調）
- `ma4` → `ma˥˩`（第四声：下降調）
- `ma` → `ma`（軽声）

**現状**: 声調番号は抽出されるがIPAトーンマークに変換されない

#### 5. テキスト正規化 - 最小限
```csharp
private string NormalizeText(string text)
{
    return text.Trim(); // 空白の除去のみ！
}
```

**不足機能**:
- 数字変換（1234 → 一千二百三十四）
- 繁体字⇔簡体字変換
- 句読点の正規化
- 略語の展開

## 実装完成度評価

**現在の状態**: **プレアルファ / 概念実証**

**推定実装完了度**: 約15-20%

**本番使用の主要なブロッカー**:
1. **辞書カバレッジ**: 422文字 vs 20,000文字以上が必要
2. **IPA変換**: 完全に機能していない
3. **テキスト分割**: 文字レベルのみ（不十分）
4. **声調処理**: IPAトーンマークなし
5. **リソース読み込み**: 外部ファイル読み込み機能なし

## 推奨開発優先順位

1. 包括的なピンイン辞書読み込みの実装
2. 声調マーク付きの適切なピンイン→IPA変換の構築
3. 基本的なテキスト分割の追加（最長一致法でも現状より改善）
4. 数字と句読点のテキスト正規化の実装
5. IPA検証を含む包括的なテストカバレッジの追加

現在の実装は構造的な基盤を提供していますが、実用的な中国語音声合成に必要な中核機能が欠けています。