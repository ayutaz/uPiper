# WebGL対応 残タスク一覧

最終更新: 2025-08-04

## 優先度別タスクリスト

### 🔴 高優先度（必須機能）

#### 1. WebGL統合テスト
- **目的**: WebGLビルドの動作確認
- **内容**:
  - ローカルWebサーバーでの動作テスト
  - 音素化機能の実際の動作確認
  - 音声生成の品質確認
- **見積工数**: 2-3日

#### 2. WebGL専用デモシーン
- **目的**: WebGL環境での使用例提示
- **内容**:
  - シンプルなUIのデモシーン作成
  - 日本語/英語切り替え機能
  - 音声再生コントロール
  - パフォーマンス表示
- **見積工数**: 3-4日

#### 3. ビルドサイズ最適化
- **目的**: ダウンロード時間短縮
- **現状**: 約100MB以上（ONNX + WASM含む）
- **対策**:
  - 不要なアセット除外
  - テクスチャ圧縮設定
  - コードストリッピング最適化
- **目標**: 50MB以下
- **見積工数**: 2日

### 🟡 中優先度（機能改善）

#### 4. 統一音素化API実装
- **目的**: 言語自動検出と切り替え
- **内容**:
  - `UnifiedWebGLPhonemizer`クラス作成
  - 言語検出ロジック実装
  - 複数言語混在テキスト対応
- **見積工数**: 3日

#### 5. WebGLランタイムテスト
- **目的**: 実際のブラウザ環境でのテスト
- **内容**:
  - Chrome/Firefox/Safari/Edgeでの動作確認
  - モバイルブラウザテスト
  - エラーハンドリング確認
- **見積工数**: 2日

#### 6. パフォーマンステスト
- **目的**: 性能基準の確立
- **測定項目**:
  - 初期化時間
  - 音素化レイテンシ
  - 音声生成速度
  - メモリ使用量
- **見積工数**: 2日

#### 7. 高度なeSpeak-ng音素化
- **現状**: 基本的な単語辞書ベース
- **改善点**:
  - 実際のeSpeak-ng IPA出力統合
  - より多くの単語対応
  - 音素変換精度向上
- **見積工数**: 3-4日

### 🟢 低優先度（将来的な拡張）

#### 8. WASMストリーミングインスタンシエーション
- **目的**: 初回ロード時間短縮
- **内容**:
  - WebAssembly.instantiateStreaming使用
  - プログレス表示実装
- **見積工数**: 2日

#### 9. プログレッシブローディング
- **目的**: UX改善
- **内容**:
  - 段階的な機能有効化
  - ローディング画面改善
  - エラーリカバリー
- **見積工数**: 3日

#### 10. Service Worker対応
- **目的**: オフライン機能
- **内容**:
  - アセットキャッシュ
  - オフライン時の動作
  - 更新通知
- **見積工数**: 4日

#### 11. モバイルブラウザ最適化
- **目的**: モバイル体験向上
- **内容**:
  - タッチUI最適化
  - メモリ使用量削減
  - レスポンシブデザイン
- **見積工数**: 3日

#### 12. 中国語音素化エンジン統合
- **目的**: 中国語サポート改善
- **内容**:
  - 中国語専用WebAssemblyエンジン検討
  - ピンイン→音素変換改善
  - トーン処理
- **見積工数**: 1週間

#### 13. SharedArrayBuffer対応
- **目的**: マルチスレッド処理
- **注意**: COOP/COEP必須
- **内容**:
  - Worker間でのメモリ共有
  - 並列処理実装
- **見積工数**: 4日

#### 14. WebGPUバックエンド
- **目的**: GPU処理高速化
- **前提**: Unity AI Inference Engine対応待ち
- **見積工数**: 未定

## 実装順序の推奨

1. **第1フェーズ**（1週間）
   - WebGL統合テスト
   - WebGL専用デモシーン
   - ビルドサイズ最適化

2. **第2フェーズ**（1週間）
   - 統一音素化API実装
   - WebGLランタイムテスト
   - パフォーマンステスト

3. **第3フェーズ**（1週間）
   - 高度なeSpeak-ng音素化
   - WASMストリーミング
   - プログレッシブローディング

4. **第4フェーズ**（オプション）
   - Service Worker対応
   - モバイルブラウザ最適化
   - 中国語音素化エンジン

## 技術的な課題と注意点

### メモリ管理
- Unity WebGLの1GBヒープ制限
- 大規模テキストでのOOM対策必要
- ガベージコレクション最適化

### ブラウザ互換性
- Safari: WebAssembly SIMD未対応
- iOS Safari: 特殊な制限あり
- モバイル: メモリ制限が厳しい

### セキュリティ
- CORS設定必須
- HTTPS必須（マイク使用時）
- CSP（Content Security Policy）対応

### パフォーマンス
- 初回ロード時間が課題
- 音声生成のリアルタイム性確保
- バックグラウンドタブでの制限

## まとめ

WebGL対応の基本実装は完了していますが、プロダクション品質にするには以下が必要：

1. **必須**: 統合テスト、デモシーン、ビルド最適化
2. **推奨**: 統一API、ランタイムテスト、パフォーマンス測定
3. **将来**: オフライン対応、モバイル最適化、追加言語

総見積工数: 約3-4週間（必須+推奨機能）